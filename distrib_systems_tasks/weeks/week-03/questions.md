# Вопросы для самопроверки

---

### 1. В чем разница между Forward Proxy (обычный прокси) и Reverse Proxy (обратный прокси)?

**Forward Proxy (прямой)**
- Работает **от имени клиента**.
- Клиент явно настроен на использование прокси.
- Скрывает IP клиента, обходит блокировки.
- Пример: корпоративный прокси, Tor.

**Reverse Proxy (обратный)**
- Работает **от имени сервера**. Сервер стоит *перед* вашими сервисами и защищает их.
- Клиент не знает о прокси, думает, что общается напрямую с бэкендом.
- Скрывает IP серверов, балансирует нагрузку.
- Пример: Nginx перед микросервисами, Cloudflare.

---

### 2. Что такое Upstream в терминологии Nginx?

**Upstream** — это группа бэкенд-серверов, на которые прокси пересылает запросы.

```nginx
upstream products_backend {
    server products-svc:8223;      # основной
    server products-svc:8224 backup; # резервный
}

server {
    location /api/products {
        proxy_pass http://products_backend; # Nginx сам выберет сервер
    }
}
```

Используется для:
- Балансировки нагрузки
- Отказоустойчивости
- Удобного управления бэкендами

### 3. Зачем скрывать реальные IP-адреса сервисов от клиента?

| Причина | Описание |
|---------|----------|
| **Безопасность** | Атаки идут только на Gateway, бэкенды находятся за фаерволом и недоступны извне |
| **Гибкость** | Можно менять IP и порты сервисов без обновления клиентских приложений |
| **Единый домен** | Клиент работает с одним адресом (API Gateway), а не с разными эндпоинтами |
| **Сокрытие реализации** | Внешний мир не видит технологии, версии ПО и внутреннюю структуру |
| **Централизованное логирование** | Все запросы проходят через единую точку, что упрощает сбор логов и метрик |



### 4. Какие еще задачи, кроме маршрутизации, может выполнять API Gateway?

**Аутентификация и авторизация** — проверка JWT, API-ключей, OAuth-токенов перед проксированием запроса к бэкенду

**Rate Limiting** — ограничение количества запросов от одного клиента (защита от DDoS-атак и брутфорса)

**Кэширование** — сохранение ответов на частые GET-запросы для снижения нагрузки на бэкенды

**SSL Termination** — расшифровка HTTPS-трафика на Gateway, внутри сети трафик идет по HTTP (быстрее и проще)

**Мониторинг и метрики** — сбор данных о времени ответа, количестве ошибок, объеме трафика (интеграция с Prometheus/Grafana)

**Трансформация данных** — изменение формата запросов/ответов (например, конвертация XML в JSON)

**Логирование** — централизованный сбор всех запросов для отладки и аудита

---

### 5. Что произойдет, если Gateway упадет? Как можно от этого защититься?

#### Последствия:
 **Единая точка отказа (SPOF)** — все сервисы становятся недоступными  
 **Ошибки у клиентов** — пользователи получают HTTP 502/504 ошибки  
 **Потеря данных** — запросы, которые не дошли до бэкендов, могут быть потеряны  

#### Способы защиты:

| Метод защиты | Описание |
|--------------|----------|
| **Репликация** | Запустить 2-3 копии Nginx/Gateway + балансировщик (Keepalived, DNS Round Robin, облачный Load Balancer) |
| **Health Checks** | Настроить проверки здоровья, чтобы балансировщик не отправлял трафик на упавший экземпляр |
| **Оркестрация** | Docker/K8s автоматически перезапустят упавший контейнер с Gateway |
| **Circuit Breaker** | Клиентские приложения переходят в offline-режим или используют кэш при недоступности Gateway |
| **Geo-DNS** | Разместить Gateway в разных дата-центрах и распределять трафик географически |
| **Резервирование** | Использовать активный и пассивный Gateway с автоматическим переключением (failover) |

**Итог:** Gateway должен быть отказоустойчивым, так как это критический компонент инфраструктуры.
