# Единая точка входа (API Gateway)
# Неделя 3: Прячем бэкенд за шлюзом

## О чём речь
Если у вас 50 микросервисов, вы не можете заставить мобильное приложение помнить 50 IP-адресов и портов. Вам нужен "швейцар", который примет запрос и проводит его в нужную дверь. Этот швейцар — **API Gateway** (в нашем случае Nginx).

## Ключевые понятия
- **Reverse Proxy** (Обратный прокси) — сервер, который стоит *перед* вашими сервисами и защищает их. Клиент думает, что общается с прокси, а прокси "под капотом" ходит в бэкенд и возвращает ответ.
- **Upstream** — это "настоящий" сервис, куда прокси пересылает запрос.
- **Routing** (Маршрутизация) — правила: "если пришло `/users`, иди налево; если `/billing`, иди направо".

## Зачем это нужно?
1. **Безопасность**: Можно закрыть прямые порты микросервисов фаерволом, оставив только Gateway.
2. **Единый домен**: Никаких `api.users.com` и `api.billing.com`, всё живет на `api.mysite.com`.
3. **SSL/TLS**: Сертификаты можно настроить только на Gateway, а внутри защищенной сети ходить по простому HTTP.
4. **Балансировка**: Gateway может размазывать нагрузку между 10 копиями одного сервиса.

## Пример
Когда вы открываете Netflix, вы делаете запрос на `api.netflix.com`. За этим адресом скрывается умный шлюз (Zuul или другой), который анализирует ваш запрос и раскидывает его по тысячам микросервисов, собирая для вас персональную выдачу фильмов.

## Задача
В реальной жизни микросервисов много, но клиент (фронтенд или мобильное приложение) не должен знать адреса каждого из них. Для этого используют **API Gateway** — единую точку входа. На этой неделе мы спрячем наш микросервис за Nginx.

## Вариант
week-03.json`
Нам понадобится название ресурса из вашего варианта (то же самое, что и раньше).

## Что нужно сделать
1. **Поднять второй сервис**:
   - Запустите ещё один экземпляр вашего приложения (или простой mock-сервис) на другом порту.
   - Пусть первый сервис отвечает за `/<resource>`, а второй — за `/other`.
2. **Настроить Nginx**:
   - Nginx должен слушать порт 80 (или 8080).
   - Запросы на `/api/v1/<resource>` должны уходить в первый сервис.
   - Запросы на `/api/v1/other` должны уходить во второй сервис.
3. **Проверить**:
   - Клиент делает запрос только в Nginx.
   - Nginx сам решает, куда переслать запрос (маршрутизация).

## Что сдавать
1. Конфиг Nginx (`nginx.conf`).
2. `docker-compose.yml` (если используете).
3. Ответы на вопросы.

## Как проверить
```bash
python3 -m pytest -v
```
Тесты будут стучаться в Nginx и ожидать ответа от бэкенда.

## Запуск 
```bash
docker-compose up --build -d
docker-compose down
```